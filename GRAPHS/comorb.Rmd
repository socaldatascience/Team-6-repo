---
title: "Liz Comorb Stuff"
author: "Team 6"
date: '2022-07-01'
output: html_document
---

```{r setup, warning = FALSE, include = FALSE}
setwd("C:\\Users\\lizvi\\Cal State Fullerton\\Jaynes, Jessica - CSUF CHOC Summer 2022 Research\\Group2")

load("cfCOVIDgroup6.RDATA")

library(tidyverse)
library(data.table)
library(gganimate)
library(gifski)

all_comorb <- select(d, contains("comorb"))

glimpse(all_comorb)

attach(d)
```


```{r warning = FALSE}

all_comorb <- all_comorb %>% mutate_if(is.factor, as.numeric) %>% 
  -1

all_comorb <- all_comorb %>% 
  mutate(total_comorb_by_patient = c(rowSums(all_comorb)))

detach(d)

attach(all_comorb)

colSums(all_comorb)

respiratory_comorb <- all_comorb %>% 
  select(contains("J")) %>% 
  sum()

gi_comorb <- select(all_comorb, contains("K", ignore.case = FALSE)) %>% 
  sum()

nutrition_comorb <- select(all_comorb, contains("E", ignore.case = FALSE), contains("nutrition")) %>% 
  sum()

cardio_comorb <- select(all_comorb, contains("I", ignore.case = FALSE) & 
         !contains("E", ignore.case = FALSE) & 
         !contains("K", ignore.case =  FALSE)) %>% 
  sum()

grouped_comorb <- data.frame(respiratory_comorb, gi_comorb, nutrition_comorb, 
                  cardio_comorb, sum(comorb_chronic_kidney_disease_N18), sum(comorb_hemoptysisR042), sum(comorb_lung_transplant_Z942), 
                  sum(comorb_nicotine_dependence_F17)) %>% 
  colSums() %>% 
  melt(value.name = 'Patients') %>% 
  mutate(comorbidity = c("Respiratory", "GI", "Nutrition", 
                  "Cardiovascular", "Chronic Kidney Disease", "Hemoptysis", "Lung Transplant", "Nicotine Dependence"))



grouped_comorb %>% 
  ggplot(aes(x = comorbidity, y = Patients)) +
  geom_bar(stat = 'identity')


```

```{r}
ggplot(joined, aes(gdp_per_capita_ppp_constant_2017_international, deaths_cause_all_causes_risk_household_air_pollution_from_solid_fuels_sex_both_age_age_standardized_rate, size = population_historical_estimates, color = entity)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_x_log10() +
  facet_wrap(~continent) +
  labs(title = 'Year: {as.integer(frame_time)}', x = 'GDP per capita', y = 'Age Standardized Rate of Death') +
  transition_time(year) +
  ease_aes('linear') +
  theme_bw() +
  theme(text = element_text(size = 15))
```
